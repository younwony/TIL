# SRE (Site Reliability Engineering)

> `[4] 심화` · 선수 지식: [모니터링](./monitoring.md), [DevOps란](./what-is-devops.md)

> 소프트웨어 엔지니어링 원칙을 인프라와 운영에 적용하여 확장 가능하고 신뢰성 높은 시스템을 구축하는 방법론

`#SRE` `#SiteReliabilityEngineering` `#사이트신뢰성엔지니어링` `#Google` `#SLI` `#SLO` `#SLA` `#ErrorBudget` `#에러예산` `#Toil` `#토일` `#Observability` `#관측가능성` `#OnCall` `#온콜` `#IncidentManagement` `#장애관리` `#Postmortem` `#포스트모템` `#Blameless` `#무비난문화` `#신뢰성` `#Reliability` `#가용성` `#Availability` `#DevOps` `#운영자동화` `#CarryingCapacity`

## 왜 알아야 하는가?

- **실무**: 대규모 서비스 운영 시 SRE 원칙이 필수. 시스템 신뢰성을 정량화하고 개선하는 체계적인 방법론 제공
- **면접**: "SRE와 DevOps 차이", "SLI/SLO/SLA 설명", "Error Budget" 등 고급 운영 역량 검증에 빈출
- **기반 지식**: 모니터링, 장애 대응, 자동화, 용량 계획 등 고급 운영 기술의 체계적 프레임워크

## 핵심 개념

- **SRE = DevOps의 구체적 구현**: DevOps가 문화와 철학이라면, SRE는 구체적 실천법
- **신뢰성의 정량화**: SLI/SLO/SLA로 신뢰성을 측정하고 목표 설정
- **Error Budget**: 100% 가용성 대신 허용 가능한 장애 예산 개념
- **Toil 제거**: 반복적인 수동 작업을 자동화로 대체

## 쉽게 이해하기

**은행 비유**

전통적인 운영팀은 **보수적인 은행**과 같습니다:
- "돈(시스템)을 잃으면 안 돼!" → 변화 최소화
- 모든 출금(배포)에 많은 서류(승인) 필요
- 결국 서비스가 경직됨

SRE는 **투자 은행**과 같습니다:
- "얼마까지 잃어도 되는가?"를 먼저 정의 (Error Budget)
- 예산 내에서는 공격적으로 투자(배포)
- 예산 소진 시 안정화에 집중

```
┌─────────────────────────────────────────────────────────────────┐
│                    SRE의 Error Budget 개념                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   목표 가용성: 99.9% (SLO)                                       │
│                                                                  │
│   ┌────────────────────────────────────────────────────┐        │
│   │████████████████████████████████████████████░░░░░░░░│        │
│   │              가용 시간 (99.9%)        │ Error Budget│        │
│   │                                       │   (0.1%)    │        │
│   └────────────────────────────────────────────────────┘        │
│                                                                  │
│   월간 Error Budget = 30일 × 24시간 × 60분 × 0.1% = 43.2분      │
│                                                                  │
│   [Budget 남음]          →    새 기능 배포 OK                    │
│   [Budget 소진]          →    안정화에 집중, 배포 중단            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## 상세 설명

### SRE의 탄생 배경

2003년 Google의 Ben Treynor가 처음 도입:

> "SRE is what happens when you ask a software engineer to design an operations function."

전통적 운영의 문제점:
- 운영팀 규모가 시스템 규모에 비례하여 증가
- 수동 작업으로 인한 인적 오류
- 개발팀과 운영팀 간의 갈등

**왜 이렇게 하는가?**

소프트웨어 엔지니어링 원칙(자동화, 코드화, 테스트)을 운영에 적용하면, 시스템 규모가 커져도 운영팀 규모가 선형적으로 증가하지 않습니다.

### SRE vs DevOps

| 구분 | DevOps | SRE |
|------|--------|-----|
| **성격** | 문화, 철학, 운동 | 구체적 역할, 실천법 |
| **탄생** | 2008년, Agile 커뮤니티 | 2003년, Google |
| **초점** | 개발-운영 협업 | 시스템 신뢰성 |
| **측정** | DORA 메트릭 | SLI/SLO/SLA |
| **비유** | "인터페이스" (무엇을) | "클래스" (어떻게) |

Google의 정의:
> "SRE is a specific implementation of DevOps"

### SLI, SLO, SLA

#### SLI (Service Level Indicator)

서비스 품질을 측정하는 **지표**:

| SLI 유형 | 설명 | 계산 예시 |
|----------|------|----------|
| **가용성** | 서비스가 정상 응답하는 비율 | 성공 요청 / 전체 요청 |
| **지연 시간** | 응답 시간 | p50, p90, p99 latency |
| **처리량** | 단위 시간당 처리량 | 초당 요청 수 (RPS) |
| **에러율** | 에러 응답 비율 | 에러 응답 / 전체 응답 |
| **정확성** | 올바른 결과 비율 | 정확한 응답 / 전체 응답 |

```
SLI 예시:

가용성 SLI = 성공한 HTTP 요청 수 / 전체 HTTP 요청 수
           = 9,990,000 / 10,000,000
           = 99.9%

지연 시간 SLI = p99 latency < 200ms 인 요청 비율
             = 99.5%
```

#### SLO (Service Level Objective)

SLI에 대한 **목표 값**:

```
SLO 예시:
- 가용성: 월간 99.9% 이상
- 지연 시간: p99 < 200ms를 99.5% 이상 달성
- 에러율: 월간 0.1% 미만
```

**SLO 설정 원칙:**
1. **달성 가능해야 함**: 현재 성능 기반으로 설정
2. **의미 있어야 함**: 사용자 경험과 연관
3. **측정 가능해야 함**: 명확한 SLI 정의 필요

#### SLA (Service Level Agreement)

SLO를 기반으로 한 **계약**:

```
SLA 예시:
- 월간 가용성 99.9% 보장
- 미달 시 서비스 크레딧 제공:
  - 99.0% ~ 99.9%: 10% 크레딧
  - 95.0% ~ 99.0%: 25% 크레딧
  - 95.0% 미만: 50% 크레딧
```

```
┌─────────────────────────────────────────────────────────────────┐
│                    SLI → SLO → SLA 관계                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌──────────────┐                                              │
│   │     SLI      │  ← 측정 지표 (What to measure)               │
│   │  가용성: ?%  │                                              │
│   └──────┬───────┘                                              │
│          │                                                       │
│          ▼                                                       │
│   ┌──────────────┐                                              │
│   │     SLO      │  ← 내부 목표 (Target)                        │
│   │  가용성 ≥    │                                              │
│   │   99.95%     │                                              │
│   └──────┬───────┘                                              │
│          │                                                       │
│          ▼                                                       │
│   ┌──────────────┐                                              │
│   │     SLA      │  ← 외부 계약 (Promise)                       │
│   │  가용성 ≥    │     + 위반 시 보상                           │
│   │   99.9%      │                                              │
│   └──────────────┘                                              │
│                                                                  │
│   TIP: SLO는 SLA보다 엄격하게 설정 (여유분 확보)                │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Error Budget (에러 예산)

**핵심 아이디어**: 100% 가용성은 불가능하고 불필요함

```
Error Budget = 100% - SLO

예시:
- SLO: 99.9% 가용성
- Error Budget: 0.1% (월 43.2분의 장애 허용)
```

**Error Budget 활용:**

| Error Budget 상태 | 개발팀 | 운영팀 |
|------------------|--------|--------|
| 충분히 남음 | 공격적 배포, 실험 가능 | 자동화/개선 작업 |
| 거의 소진 | 보수적 배포, 안정성 우선 | 장애 원인 분석 |
| 소진됨 | 배포 동결, 안정화 집중 | 긴급 안정화 작업 |

**왜 이렇게 하는가?**

Error Budget은 개발팀과 운영팀 간의 갈등을 해소합니다:
- 개발팀: "빨리 배포하고 싶어!" → 예산이 있으면 OK
- 운영팀: "안정성이 중요해!" → 예산 소진 시 보호됨

### Toil (토일)

반복적이고, 자동화 가능하며, 가치를 창출하지 않는 수동 작업:

| Toil의 특성 | 설명 |
|------------|------|
| **수동적** | 사람이 직접 수행 |
| **반복적** | 동일한 작업의 반복 |
| **자동화 가능** | 스크립트/도구로 대체 가능 |
| **가치 미창출** | 서비스 성장에 기여하지 않음 |
| **선형 확장** | 부하에 비례하여 증가 |

**Toil 예시:**
- 수동 배포
- 반복적인 알림 확인
- 수동 스케일링
- 패스워드 리셋 처리

**Google의 원칙**: SRE는 업무 시간의 50% 이상을 Toil이 아닌 엔지니어링 작업에 투자해야 함

### On-Call과 장애 대응

#### On-Call 원칙

```
┌─────────────────────────────────────────────────────────────────┐
│                      On-Call 피라미드                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                        ┌────────────┐                           │
│                        │  Escalate  │ ← 해결 불가 시            │
│                        └─────┬──────┘                           │
│                              │                                   │
│                    ┌─────────┴─────────┐                        │
│                    │   Secondary       │ ← 백업 담당자          │
│                    └─────────┬─────────┘                        │
│                              │                                   │
│              ┌───────────────┴───────────────┐                  │
│              │        Primary On-Call        │ ← 1차 담당자     │
│              └───────────────────────────────┘                  │
│                                                                  │
│   규칙:                                                         │
│   - 한 사람이 연속 On-Call 불가 (최소 로테이션)                 │
│   - 장애 발생 시 5분 내 응답                                     │
│   - 모든 장애는 Postmortem 작성                                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### Postmortem (사후 분석)

장애 발생 후 작성하는 분석 문서:

```markdown
## Postmortem: 결제 서비스 장애 (2025-01-10)

### 요약
- 시작: 2025-01-10 14:32 KST
- 종료: 2025-01-10 15:45 KST
- 영향: 결제 실패율 30% 증가
- 근본 원인: DB 커넥션 풀 고갈

### 타임라인
- 14:32 - 결제 실패 알림 발생
- 14:35 - On-Call 엔지니어 대응 시작
- 14:50 - DB 커넥션 문제 확인
- 15:00 - 커넥션 풀 설정 변경
- 15:45 - 서비스 정상화 확인

### 근본 원인
트래픽 급증으로 DB 커넥션 풀 고갈.
커넥션 반환 누수 버그 존재.

### 조치 사항
- [완료] 커넥션 풀 크기 증가 (50 → 100)
- [진행중] 커넥션 누수 버그 수정
- [예정] 커넥션 풀 모니터링 대시보드 추가

### 교훈
- 커넥션 풀 메트릭 모니터링 필요
- 부하 테스트 시 커넥션 포함
```

**Blameless Culture**: Postmortem은 "누가" 잘못했는지가 아니라 "시스템이 왜" 실패했는지에 집중

### SRE 조직 모델

| 모델 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **중앙 집중형** | 별도의 SRE 팀 | 전문성 집중 | 개발팀과 거리감 |
| **임베디드** | 각 개발팀에 SRE 배치 | 긴밀한 협업 | 일관성 부족 |
| **컨설팅** | SRE가 여러 팀 지원 | 지식 확산 | 깊은 참여 어려움 |

## 트레이드오프

| 장점 | 단점 |
|------|------|
| 신뢰성의 정량화/측정 가능 | 높은 기술 역량 요구 |
| 개발-운영 갈등 해소 (Error Budget) | 초기 도입 비용 |
| 자동화로 운영 효율 향상 | 조직 문화 변화 필요 |
| 체계적인 장애 대응 | 측정 인프라 구축 필요 |
| 확장 가능한 운영 모델 | 소규모 조직에는 과할 수 있음 |

## 면접 예상 질문

### Q: SRE와 DevOps의 차이점은 무엇인가요?

A: DevOps는 개발과 운영의 협업을 강조하는 **문화와 철학**이고, SRE는 그것을 구현하는 **구체적인 역할과 실천법**입니다. Google의 표현으로 "SRE is a specific implementation of DevOps"입니다. DevOps가 "무엇을" 해야 하는지 정의한다면, SRE는 "어떻게" 해야 하는지 구체화합니다. SRE는 SLI/SLO/SLA로 신뢰성을 정량화하고, Error Budget으로 변경 속도와 안정성의 균형을 맞춥니다.

### Q: Error Budget이란 무엇이고 왜 필요한가요?

A: Error Budget은 100%에서 SLO를 뺀 허용 가능한 장애 예산입니다. 예를 들어 SLO가 99.9%면 Error Budget은 0.1%(월 43분)입니다. 필요한 이유:
1. **100% 가용성은 불가능하고 비용 대비 효과가 낮음**
2. **개발팀-운영팀 갈등 해소**: 예산이 있으면 배포 가능, 소진되면 안정화
3. **의사결정 기준 제공**: 주관적 판단이 아닌 객관적 기준으로 배포 결정

### Q: SLI, SLO, SLA를 설명해주세요.

A:
- **SLI(Service Level Indicator)**: 서비스 품질을 측정하는 지표 (예: 가용성 99.95%, p99 latency 200ms)
- **SLO(Service Level Objective)**: SLI에 대한 내부 목표 (예: "월간 가용성 99.9% 이상 유지")
- **SLA(Service Level Agreement)**: SLO 기반의 고객과의 계약, 미달 시 보상 조항 포함

보통 SLO는 SLA보다 엄격하게 설정하여 여유분을 확보합니다. 예: SLA 99.9% → 내부 SLO 99.95%

## 연관 문서

| 문서 | 연관성 | 난이도 |
|------|--------|--------|
| [DevOps란](./what-is-devops.md) | SRE의 상위 개념 | [1] 정의 |
| [모니터링](./monitoring.md) | SLI 측정의 기반 | [3] 중급 |
| [CI/CD](./ci-cd.md) | 배포 자동화 | [2] 입문 |
| [가용성](../system-design/availability.md) | 시스템 가용성 개념 | [2] 입문 |
| [서킷브레이커](../system-design/circuit-breaker.md) | 장애 전파 방지 | [3] 중급 |

## 참고 자료

- [Google SRE Book](https://sre.google/sre-book/table-of-contents/)
- [Google SRE Workbook](https://sre.google/workbook/table-of-contents/)
- [Site Reliability Engineering](https://landing.google.com/sre/)
- [Implementing Service Level Objectives](https://www.oreilly.com/library/view/implementing-service-level/9781492076803/)
