%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e1f5fe', 'primaryTextColor': '#333', 'primaryBorderColor': '#0288d1', 'lineColor': '#333', 'secondaryColor': '#f3e5f5', 'tertiaryColor': '#fff3e0'}}}%%
flowchart TB
    subgraph Step1["1. Claude가 Tool 호출 결정"]
        Decision["Edit 도구로 config.js 수정"]
    end

    subgraph Step2["2. PreToolUse Hook 트리거"]
        Matcher["matcher: Edit 일치"]
        Command["command 실행"]
    end

    subgraph Step3["3. Hook에 JSON 입력 전달 (stdin)"]
        JSON["{ tool_name: Edit,<br/>tool_input: { file_path: ... } }"]
    end

    subgraph Step4["4. Hook 결과 평가"]
        Exit0["exit 0: Tool 실행 진행"]
        Exit2["exit 2: Tool 실행 차단<br/>stderr를 Claude에 전달"]
        ExitOther["exit 1,3+: 경고 후 진행"]
    end

    subgraph Step5["5. Tool 실행"]
        Execute["차단되지 않은 경우 실행"]
    end

    subgraph Step6["6. PostToolUse Hook 트리거"]
        Post["자동 포맷팅, 로깅 등"]
    end

    Step1 --> Step2
    Matcher --> Command
    Step2 --> Step3
    Step3 --> Step4

    Exit0 --> Step5
    Exit2 -.->|차단| Blocked["Tool 실행 안 됨"]
    ExitOther --> Step5

    Step5 --> Step6

    style Decision fill:#e3f2fd
    style Exit0 fill:#c8e6c9
    style Exit2 fill:#ffcdd2
    style Blocked fill:#ffcdd2
    style Post fill:#e1bee7
