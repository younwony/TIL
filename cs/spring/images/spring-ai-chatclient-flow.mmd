sequenceDiagram
    participant U as 사용자
    participant CC as ChatClient
    participant A1 as MemoryAdvisor
    participant A2 as RAG Advisor
    participant CM as ChatModel
    participant AI as AI Provider

    U->>CC: prompt("질문")

    rect rgb(52, 152, 219, 0.1)
        Note over CC,A2: 요청 가공 (Advisor Chain 순방향)
        CC->>A1: 요청 전달
        A1->>A1: 대화 기록 추가
        A1->>A2: 요청 전달
        A2->>A2: 벡터 검색 + 컨텍스트 보강
    end

    rect rgb(46, 204, 113, 0.1)
        Note over CM,AI: AI 호출
        A2->>CM: 보강된 프롬프트
        CM->>AI: API 호출 (HTTP)
        AI-->>CM: 응답
    end

    rect rgb(155, 89, 182, 0.1)
        Note over CC,A2: 응답 후처리 (Advisor Chain 역방향)
        CM-->>A2: 응답 전달
        A2-->>A1: 응답 전달
        A1->>A1: 대화 기록 저장
        A1-->>CC: 응답 전달
    end

    CC-->>U: 최종 응답 반환
