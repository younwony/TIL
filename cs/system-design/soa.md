# SOA (Service-Oriented Architecture)

> `[3] 중급` · 선수 지식: [시스템 설계란](./what-is-system-design.md), [Layered Architecture](./layered-architecture.md)

> 비즈니스 기능을 독립적인 서비스로 구성하고, 표준화된 인터페이스를 통해 통신하는 아키텍처 스타일

`#SOA` `#ServiceOrientedArchitecture` `#서비스지향아키텍처` `#ESB` `#SOAP` `#WebService` `#WSDL` `#Enterprise`

## 왜 알아야 하는가?

SOA는 **MSA의 전신**이자 엔터프라이즈 시스템 통합의 핵심 개념입니다. 많은 레거시 시스템이 SOA 기반이며, MSA와의 차이점을 이해해야 현대적인 아키텍처로의 전환을 설계할 수 있습니다.

- **실무**: 레거시 시스템 이해, 시스템 통합 프로젝트
- **면접**: "SOA와 MSA의 차이점은?"
- **기반 지식**: MSA, Enterprise Integration 이해의 전제

## 핵심 개념

- **Service (서비스)**: 비즈니스 기능 단위의 재사용 가능한 컴포넌트
- **ESB (Enterprise Service Bus)**: 서비스 간 통신을 중재하는 미들웨어
- **SOAP/WSDL**: 표준화된 통신 프로토콜과 서비스 기술 언어

## 쉽게 이해하기

**SOA**를 대형 쇼핑몰의 통합 안내 데스크에 비유할 수 있습니다.

```
┌─────────────────────────────────────────────────────────┐
│                    쇼핑몰 (Enterprise)                    │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │           통합 안내 데스크 (ESB)                   │   │
│  │   - 모든 문의는 여기로                            │   │
│  │   - 적절한 매장으로 안내                          │   │
│  │   - 통역 서비스 (프로토콜 변환)                   │   │
│  └──────────────────────────────────────────────────┘   │
│          ↓         ↓         ↓         ↓                │
│     ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐        │
│     │의류매장│ │식품매장│ │가전매장│ │문화센터│        │
│     │(서비스)│ │(서비스)│ │(서비스)│ │(서비스)│        │
│     └────────┘ └────────┘ └────────┘ └────────┘        │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

고객(클라이언트)은 안내 데스크(ESB)에만 요청하면, 알아서 적절한 매장(서비스)으로 연결됩니다.

## 상세 설명

### SOA 구성 요소

```
┌─────────────────────────────────────────────────────────┐
│                    SOA Architecture                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  Consumer                                                │
│     │                                                    │
│     ▼                                                    │
│  ┌──────────────────────────────────────────────────┐   │
│  │                 ESB (Enterprise Service Bus)      │   │
│  │  ┌─────────────────────────────────────────────┐ │   │
│  │  │ - Routing (라우팅)                           │ │   │
│  │  │ - Protocol Transformation (프로토콜 변환)    │ │   │
│  │  │ - Message Enhancement (메시지 보강)          │ │   │
│  │  │ - Orchestration (오케스트레이션)            │ │   │
│  │  │ - Security (보안)                           │ │   │
│  │  │ - Monitoring (모니터링)                     │ │   │
│  │  └─────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────┘   │
│          │           │           │           │          │
│          ▼           ▼           ▼           ▼          │
│     ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐     │
│     │Service │  │Service │  │Service │  │Legacy  │     │
│     │   A    │  │   B    │  │   C    │  │System  │     │
│     │ (SOAP) │  │ (REST) │  │ (JMS)  │  │(Custom)│     │
│     └────────┘  └────────┘  └────────┘  └────────┘     │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### ESB의 역할

| 기능 | 설명 | 예시 |
|------|------|------|
| **Routing** | 요청을 적절한 서비스로 전달 | 상품 코드 기반으로 담당 서비스 선택 |
| **Transformation** | 메시지 형식 변환 | XML ↔ JSON, SOAP ↔ REST |
| **Orchestration** | 여러 서비스 호출 조합 | 주문 = 재고 확인 + 결제 + 배송 |
| **Mediation** | 프로토콜 변환 | HTTP → JMS, SOAP → REST |
| **Security** | 인증, 인가, 암호화 | 토큰 검증, 접근 제어 |

### SOAP vs REST

```xml
<!-- SOAP 요청 예시 -->
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
    <soap:Header>
        <auth:Token>abc123</auth:Token>
    </soap:Header>
    <soap:Body>
        <order:CreateOrder>
            <order:ProductId>P001</order:ProductId>
            <order:Quantity>2</order:Quantity>
        </order:CreateOrder>
    </soap:Body>
</soap:Envelope>
```

```
// REST 요청 예시
POST /orders HTTP/1.1
Content-Type: application/json
Authorization: Bearer abc123

{
    "productId": "P001",
    "quantity": 2
}
```

| 항목 | SOAP | REST |
|------|------|------|
| 프로토콜 | XML 기반 프로토콜 | 아키텍처 스타일 |
| 형식 | XML만 | JSON, XML 등 |
| 스펙 | WSDL로 명세 | OpenAPI/Swagger |
| 상태 | Stateful 가능 | Stateless |
| 표준 | WS-* 표준 (WS-Security 등) | 표준 없음 (유연) |

### SOA vs MSA

| 항목 | SOA | MSA |
|------|-----|-----|
| **서비스 크기** | 큰 비즈니스 기능 | 작은 단일 기능 |
| **통신** | ESB (중앙 집중) | 직접 통신 (분산) |
| **데이터** | 공유 데이터베이스 가능 | 서비스별 독립 DB |
| **배포** | 서비스 단위 | 독립적 배포 |
| **기술 스택** | 통일된 기술 | 서비스별 자유 |
| **거버넌스** | 중앙 집중식 | 분산 거버넌스 |

```
SOA
┌────────────────────────────────────────────────────┐
│                       ESB                           │
├────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐               │
│  │ 주문 서비스   │  │ 고객 서비스   │               │
│  │ (대규모)     │  │ (대규모)     │               │
│  └──────────────┘  └──────────────┘               │
│           ↓                ↓                       │
│  ┌─────────────────────────────────────────────┐  │
│  │            공유 데이터베이스                  │  │
│  └─────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────┘

MSA
┌────────────────────────────────────────────────────┐
│                                                     │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐     │
│  │ 주문     │←──→│ 결제     │←──→│ 배송     │     │
│  │ Service  │    │ Service  │    │ Service  │     │
│  └────┬─────┘    └────┬─────┘    └────┬─────┘     │
│       ↓               ↓               ↓           │
│  ┌────────┐      ┌────────┐      ┌────────┐      │
│  │ 주문DB │      │ 결제DB │      │ 배송DB │      │
│  └────────┘      └────────┘      └────────┘      │
│                                                     │
└────────────────────────────────────────────────────┘
```

## 트레이드오프

| 장점 | 단점 |
|------|------|
| 서비스 재사용성 | ESB 단일 장애점 (SPOF) |
| 표준화된 인터페이스 | ESB 복잡도 증가 |
| 레거시 시스템 통합 | 성능 병목 가능 |
| 중앙 집중 관리 | 벤더 종속 위험 |

### 언제 사용하나?

**적합한 경우**:
- 이기종 시스템 통합 (레거시 + 신규)
- 엔터프라이즈 규모의 조직
- 표준화된 거버넌스 필요
- 기존 SOAP 기반 시스템 연동

**부적합한 경우**:
- 빠른 변화가 필요한 시스템
- 소규모 팀/프로젝트
- 클라우드 네이티브 신규 개발

## 면접 예상 질문

### Q: SOA와 MSA의 핵심 차이는?

A: **통신 방식**과 **서비스 크기**가 다릅니다. SOA는 **ESB를 통한 중앙 집중 통신**, 큰 비즈니스 기능 단위 서비스, 공유 DB 허용. MSA는 **서비스 간 직접 통신**, 작은 단일 기능 서비스, 서비스별 독립 DB. **왜 MSA가 등장했나?** ESB가 병목/단일 장애점이 되고, 클라우드 환경에서 독립 배포/확장이 중요해졌기 때문입니다.

### Q: ESB의 역할과 문제점은?

A: **역할**: 라우팅, 프로토콜 변환, 오케스트레이션, 보안 등 서비스 간 통신의 모든 것을 담당. **문제점**: (1) 단일 장애점 - ESB 장애 시 전체 시스템 마비 (2) 성능 병목 - 모든 트래픽이 ESB 통과 (3) 복잡도 증가 - 비즈니스 로직이 ESB에 포함되기도 함 (4) 벤더 종속 - 특정 ESB 제품에 종속.

## 연관 문서

| 문서 | 연관성 | 난이도 |
|------|--------|--------|
| [시스템 설계란](./what-is-system-design.md) | 선수 지식 | [1] 정의 |
| [Layered Architecture](./layered-architecture.md) | 기본 아키텍처 | [2] 입문 |
| [MSA vs 모놀리식](./msa-vs-monolithic.md) | 비교, 발전 | [3] 중급 |
| [메시지 큐](./message-queue.md) | 비동기 통신 | [3] 중급 |

## 참고 자료

- Enterprise Integration Patterns - Gregor Hohpe
- SOA Principles of Service Design - Thomas Erl
- [SOA vs Microservices - IBM](https://www.ibm.com/topics/soa)
