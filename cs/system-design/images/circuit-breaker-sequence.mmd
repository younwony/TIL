%%{init: {'look': 'handDrawn', 'theme': 'base'}}%%
sequenceDiagram
    autonumber
    participant Client as ğŸ–¥ï¸ Client
    participant CB as ğŸ”Œ Circuit Breaker
    participant Service as ğŸ›’ Payment Service

    rect rgb(200, 230, 200)
        Note over Client, Service: CLOSED ìƒíƒœ (ì •ìƒ)
        Client->>CB: ê²°ì œ ìš”ì²­
        CB->>Service: ìš”ì²­ ì „ë‹¬
        Service-->>CB: ì„±ê³µ ì‘ë‹µ
        CB-->>Client: ê²°ì œ ì™„ë£Œ
    end

    rect rgb(255, 200, 200)
        Note over Client, Service: ì¥ì•  ë°œìƒ â†’ OPEN ì „í™˜
        Client->>CB: ê²°ì œ ìš”ì²­
        CB->>Service: ìš”ì²­ ì „ë‹¬
        Service--xCB: íƒ€ì„ì•„ì›ƒ / ì—ëŸ¬
        CB-->>Client: ì‹¤íŒ¨ (ì‹¤íŒ¨ ì¹´ìš´íŠ¸ ì¦ê°€)

        Note right of CB: ì‹¤íŒ¨ìœ¨ 50% ì´ˆê³¼!
        CB->>CB: ìƒíƒœ â†’ OPEN

        Client->>CB: ê²°ì œ ìš”ì²­
        CB--xClient: ì¦‰ì‹œ ì‹¤íŒ¨ (Fallback)
        Note right of CB: ì„œë¹„ìŠ¤ í˜¸ì¶œ ì—†ì´<br/>ë°”ë¡œ ì‹¤íŒ¨ ë°˜í™˜
    end

    rect rgb(255, 230, 180)
        Note over Client, Service: HALF-OPEN ìƒíƒœ (ë³µêµ¬ í…ŒìŠ¤íŠ¸)
        Note right of CB: 60ì´ˆ ê²½ê³¼...
        CB->>CB: ìƒíƒœ â†’ HALF-OPEN

        Client->>CB: ê²°ì œ ìš”ì²­
        CB->>Service: í…ŒìŠ¤íŠ¸ ìš”ì²­ (1ê±´ë§Œ)
        Service-->>CB: ì„±ê³µ ì‘ë‹µ
        CB->>CB: ìƒíƒœ â†’ CLOSED
        CB-->>Client: ê²°ì œ ì™„ë£Œ
    end
